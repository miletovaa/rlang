---
title: "Animalsâ€™ life span. Factors that play role in the longevity of animals."
subtitle: "Data Programming course project work"
author:
  - name: Anna Miletova (BF1-EN)
    email: "annamiletova@gmail.com, 89231151@student.upr.si"
    affiliation: 
      - University Primorska FAMNIT, Koper, Slovenia
date: "`r format(Sys.time(), '%e %B %Y')`"
format: 
  html:
    embed-resources: true
execute: 
  messages: false
  echo: false
  error: false
---

```{r}
library(tidyverse)
library(gridExtra)
```

## 1. Introduction

<!--
*Introduction / Presentation and description of the problem*
-->

Understanding the relationship between animal life expectancy and various factors is pivotal in explanation of the dynamics of biological longevity. In this project, I have been discovering the patterns and dependencies that cause the longevity of different animal species. By analyzing factors such as **order classification, body mass, diet type, and social structure** with the help of data visualization, I aimed to explain the impact of these variables on life expectancy of species.

## 2. Dataframes

<!--
*Presentation of the data (present the data by showing the head of your dataframes, showing the types and explaining what is column is/what unit is in.)*
-->

#### In my work I've used two dataframes:

### 1) Animal Information Dataset

```{r}
  animals <- read.csv("Animal Dataset.csv", header = TRUE, sep = ",")
  
  animals <- select(animals,
      Animal,
      Lifespan..years.,
      Weight..kg.,
      Diet,
      Social.Structure) %>%
    group_by(Animal) %>%
    slice(1)

  animals <- ungroup(animals)
```

The data in the dataframe was filtered to get only **unique entries** of the information we are interested in according to the chosen topic. The used columns are: 

```{r}
  print(colnames(animals))
```

This dataframe contains the majority of the necessary data for my research, including *habitat, body mass, diet type,* and *social structure* of the animal species, forming the foundation of the work.

```{r}
  as_tibble(animals)
```

### 2) Animals

```{r}
  classifications <- read.csv("animals.csv", header = TRUE, sep = ",")
  
  classifications <- select(classifications, 
    Animal.Name,
    Class,
    Order,
    Family,
    Genus)
```

This dataframe was involved to get more **detailed animal's classification info** such as:

```{r}
  print(colnames(classifications) %>% setdiff("Animal.Name"))
```

## 3. Data aggregation

<!--
*Aggregation of data. Show the result as a table (at least 3). Use only methods, that lead to a solution, like user defined functions, mutate, filter, summarise, inner_join, ggplot. Use the tidyverse approach by chaining the above functions and using pipes %>%.*
-->

#### For the further analysis, it was needed to process some data.

1) *Lifespan* values were **inconsistent**, so I got a new column *Average Lifespan (dbl, in years)* using defined function and `mutate`. The same was done with the *Weight..kg.* column. The entries with unknown average lifespan were filtered with `filter`, since this parameter is the key of the whole research.

```{r}
  process_intervals <- function(col) {
    cleaned_values <- numeric(length(col))
    
    intervals <- grepl("-", col)
    cleaned_values[intervals] <- strsplit(col[intervals], "-") %>% 
      sapply(function(x) mean(as.double(x), na.rm = TRUE))
    
    days_values <- grepl("days", col, ignore.case = TRUE)
    days_numbers <- as.double(gsub("[^0-9]+", "", col[days_values]))
    cleaned_values[days_values] <- days_numbers / 365
    
    weeks_values <- grepl("weeks", col, ignore.case = TRUE)
    weeks_numbers <- as.double(gsub("[^0-9]+", "", col[weeks_values]))
    cleaned_values[weeks_values] <- weeks_numbers / 52
  
    months_values <- grepl("months", col, ignore.case = TRUE)
    months_numbers <- as.double(gsub("[^0-9]+", "", col[months_values]))
    cleaned_values[months_values] <- months_numbers / 12
    
    remaining_values <- !(intervals | days_values | months_values)
    cleaned_values[remaining_values] <- as.double(gsub("[^0-9]+", "", col[remaining_values]))
    
    return(cleaned_values)
  }
  
  data <- animals %>%
    mutate(Average.Lifespan = process_intervals(Lifespan..years.),
           Weight..kg. = process_intervals(Weight..kg.)) %>%
    filter(!is.na(Average.Lifespan))
  
  data$Lifespan..years. <- NULL
```

2) Merging dataframes to get animal's classification info:

```{r}
  data <- inner_join(data, classifications, by = c("Animal" = "Animal.Name"))
```

The result dataframe I have been working with for my data analysis:

```{r}
  glimpse(data)
```

## 4. Explotary data analysis

<!--
*Visualisation of the data, at least 3 relevant (and
distinct) ggplots, that are not the same type of plot. Explain each
ggplot)*
-->

This part of my work is dedicated for discovering of the patterns of the dependencies between **animals life expectancy** and different **factors**.

```{r}
  plot_top <- function(data, key_col, top_n) {
    top_animals <- data %>%
      arrange(desc(Average.Lifespan)) %>%
      distinct(Animal, .keep_all = TRUE) %>%
      head(top_n)
    
    top_animals$Animal <- factor(top_animals$Animal, levels = top_animals$Animal[order(top_animals$Average.Lifespan)])
    
    bar_plot <- ggplot(top_animals, aes(x = Animal, y = Average.Lifespan, fill = !!sym(key_col))) +
      geom_bar(stat = "identity") +
      coord_flip() +
      labs(x = "Animal", y = "Average lifespan (years)") +
      guides(fill = "none") +
      theme_minimal()
    
    pie_data <- top_animals %>%
      count(!!sym(key_col)) %>%
      mutate(perc = n / sum(n) * 100)
    
    pie_plot <- ggplot(pie_data, aes(x = "", y = perc, fill = !!sym(key_col))) +
      geom_bar(stat = "identity") + 
      coord_polar(theta = "y") +
      scale_fill_discrete(labels = function(x) paste0(x, " (", round(pie_data$perc), "%)")) +
      theme_void()
    
    grid.arrange(bar_plot, pie_plot, ncol = 2)
  }
```

### General analysis

First of all, the orders of the absolute long-livers were discovered. I grouped the animals by their *orders* and visualized the graphic of the average lifespans among the representatives of each order.

```{r}
  orders_data <- data %>% 
    group_by(Order) %>% 
    summarise(mean_lifespan = mean(Average.Lifespan)) %>% 
    arrange(desc(mean_lifespan))
  
  ggplot(orders_data, aes(x = Order, y = mean_lifespan, fill = Order)) +
    geom_col() +
    ggtitle("Mean Lifespan by Order") +
    ylab("Mean Lifespan") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
    
  plot_top(data, "Order", 50)
```

Due to the graphic analysis result, could be easily detected that absolute long-livers are the representatives of **Testudines, Sirenia** and **Proboscidea** orders.

After, for the more detailed analysis I have displayed *top 50 longest-living animals* and highlighted them by the criterea - *order*. ***This method will be used further in my analysis for other factors as well.***

Graphics show us that among the animals with the longest lifespan there are also the representatives of **Primates, Artiodactyla, Carnivora, Squamata** and **Perissodactyla** orders.

With the further analysis I was trying to explain the patterns of this result. Further analysis included only mentioned top long-livers.

```{r}
  data <- data %>%
    filter(Order %in% c("Primates", "Artiodactyla", "Carnivora", "Testudines", "Sirenia", "Proboscidea", "Squamata", "Perissodactyla"))
```

## Body Mass and long-living

```{r}
  ggplot(data %>% filter(!is.na(Weight..kg.)), aes(x = Average.Lifespan, y = Weight..kg., color = Order)) +
    geom_point() +
    labs(x = "Average Lifespan (years)", y = "Body Mass (kg)")
```

In general it is seen that among long-livers there are animals of **very diverse masses**. Moreover, on the increased scales a pattern was not detected as well.

```{r}
  mass_plot <- function (data, scale) {
    ggplot(data %>% filter(!is.na(Weight..kg.) & Weight..kg. <= scale), 
           aes(x = Average.Lifespan, y = Weight..kg., color = Order)) +
      geom_point() +
      labs(x = "Average Lifespan (years)", y = paste0("Body Mass (kg), up to ", scale)) +
      scale_y_continuous(limits = c(0, scale)) +
      guides(color = "none")
  }

  grid.arrange(
    mass_plot(data, 5000), 
    mass_plot(data, 1000), 
    mass_plot(data, 100), 
    ncol = 3)
```

Interesting observation is that there are mostly **gigantic ot miniature/average creatures** among long-livers. This observation aligns with **Peto's paradox**, which suggests that larger animals should have a higher risk of cancer due to more cells and longer lifespans, yet many larger animals, like elephants, whales, and tortoises, exhibit lower cancer rates.

### Diet type impact on the lifespan

For the analysis, I took top 20 long-livers and highlighted them by the diet type.

```{r}
  plot_top(data, "Diet", 20)
```

The graphic illustrates an obvious pattern: **non-carnivores averagely live longer**. The lifespan of filter feeders (aquatic animals that acquire nutrients by feeding on organic matters, food particles or smaller organisms), herbivores (species that eat only plants) and omnivores (those who can eat both, meat and plants) is longer.

### Social structure factor impact on the lifespan

Analogically to the previous factor analysis, I took top 20 long-livers and highlighted them by their social structure.

```{r}
  plot_top(data, "Social.Structure", 20)
```

Surprisingly, the **solitary** social structure absolutely prevailed. This can be related to the fact that these species are **less detectable by predators**, most likely to be **polygynous**, have lower **transmission of diseases rate** and have **reduced competition**, leading to  less stress and lower risk of injuries. 

## 5. Conclusion

<!--
*Interpretation / Conclusion*
-->

In conclusion, this project was created in order to give an explanation of the patterns of animal life expectancy and its correlations with few selected factors.

The initial analysis of top-50 animals by lifespan, categorized by order, unveiled that **Primates, Artiodactyla, Carnivora, Squamata,** and **Perissodactyla** tend to have longer lifespans on average, while **Testudines, Sirenia,** and **Proboscidea** stand out as absolute long-livers.

Further investigation explored the relationship between lifespan and body mass, revealing a **diverse range of body sizes** among long-living species.

The impact of diet type emerged as a significant determinant of lifespan, with **non-carnivores** exhibiting longer lifespans on average. Similarly, an analysis of social structures among long-livers revealed a prevalence of **solitary species**, potentially attributable to reduced predation risk, lower disease transmission, and decreased competition.

In essence, this project illuminates the multifaceted interplay between animal life expectancy and various ecological and biological factors, underscoring the complexity of evolutionary adaptations and ecological dynamics in shaping longevity among diverse species.

## 6. References

(@) Animal Information Dataset ([kaggle.com](https://www.kaggle.com/datasets/iamsouravbanerjee/animal-information-dataset))
(@) Animals Dataset ([kaggle.com](https://www.kaggle.com/datasets/hessahalkhattabi/animals))
(@) Primate Sociality and Social Systems ([Nature](https://www.nature.com/scitable/knowledge/library/primate-sociality-and-social-systems-58068905/))
(@) Social organization of a solitary carnivore ([The Royal Society](https://royalsocietypublishing.org/doi/10.1098/rsos.182160))
(@) Peto's paradox ([widipedia.org](https://en.wikipedia.org/wiki/Peto%27s_paradox))
